<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabella Estesa con 12 Righe</title>
    <style>
        body {
            font-family: sans-serif; /* Carattere leggibile per tutto il corpo */
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4; /* Sfondo generale tenue */
        }

        table {
            border-collapse: collapse; /* Unisce i bordi delle celle */
            width: 98%; /* Larghezza maggiore per molte colonne */
            margin: 20px auto; /* Centra la tabella e aggiunge margine */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Ombra leggera */
            background-color: #fff; /* Sfondo bianco per la tabella */
            font-size: 0.9em; /* Riduci leggermente la dimensione generale del testo della tabella per farla stare */
        }

        th, td {
            border: 1px solid #ddd; /* Bordo leggero per le celle */
            padding: 6px; /* Spazio interno ridotto */
            text-align: center; /* Centra il testo */
        }

        th {
            background-color: #e9ecef; /* Sfondo grigio chiaro per l'intestazione */
            font-weight: bold;
            color: #333;
        }

        /* Colori tenui di sfondo per le prime 4 colonne di TUTTE le righe dati (class="data-row") */
        .data-row td:nth-child(1) { background-color: #e0f7fa; /* Azzurro tenue */ }
        .data-row td:nth-child(2) { background-color: #fff9c4; /* Giallo tenue */ }
        .data-row td:nth-child(3) { background-color: #f8bbd0; /* Rosa tenue */ }
        .data-row td:nth-child(4) { background-color: #c8e6c9; /* Verde tenue */ }


        /* Stile per i campi di input */
        td input[type="text"] {
            width: 100%; /* Riempi la larghezza della cella */
            box-sizing: border-box; /* Include padding e border nella larghezza */
            padding: 4px; /* Padding ridotto */
            border: 1px solid #ccc;
            text-align: center; /* Centra il testo nell'input */
            background-color: white; /* Sfondo bianco solo dove scrivi */
            font-size: 1em; /* Font size base per gli input */
        }

        /* Aumenta la dimensione del testo solo nell'input della prima colonna delle righe dati */
        .data-row td:nth-child(1) input[type="text"] {
            font-size: 140%; /* Aumenta la dimensione del testo del 40% */
        }

         /* Stile per le caselle di testo calcolate (span dentro td) */
        td span {
            display: block; /* Rendi lo span un blocco per riempire la cella e centrarlo meglio */
            padding: 4px; /* Padding ridotto */
            font-weight: bold; /* Rendi il testo più visibile */
            color: inherit; /* Eredita il colore del testo, per poterlo cambiare via JS */
        }

        /* Stile per la cella del pulsante Reset */
        .reset-cell { /* Usiamo una classe per coerenza */
             text-align: center;
             vertical-align: middle; /* Centra verticalmente il contenuto */
             background-color: #f2f2f2; /* Sfondo leggero */
        }

        /* Stile per il pulsante Reset */
        .reset-button { /* Usiamo una classe per coerenza */
            padding: 4px 8px; /* Padding ridotto */
            background-color: #dc3545; /* Rosso */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em; /* Font size ridotto */
            transition: background-color 0.3s ease;
        }

        .reset-button:hover {
            background-color: #c82333; /* Rosso più scuro al passaggio del mouse */
        }

        /* Rendi la tabella scrollabile orizzontalmente se troppo stretta */
         .table-container {
             overflow-x: auto;
         }

    </style>
</head>
<body>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>player name</th>
                    <th>my points</th>
                    <th>opponent 1</th>
                    <th>opponent 2</th>
                    <th>delta o1</th>
                    <th>delta o2</th>
                    <th></th> </tr>
            </thead>
            <tbody id="tableBody">
                <tr class="data-row" data-row-suffix="_row1">
                    <td><input type="text" id="playerName_row1" value=""></td>
                    <td><input type="text" id="myPoints_row1" value="0"></td>
                    <td><input type="text" id="opponent1_row1" value="0"></td>
                    <td><input type="text" id="opponent2_row1" value="0"></td>
                    <td id="cellDeltaO1_row1"><span id="deltaO1_row1">0</span></td>
                    <td id="cellDeltaO2_row1"><span id="deltaO2_row1">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row1">Reset</button></td>
                </tr>
                <tr class="data-row" data-row-suffix="_row2">
                    <td><input type="text" id="playerName_row2" value=""></td>
                    <td><input type="text" id="myPoints_row2" value="0"></td>
                    <td><input type="text" id="opponent1_row2" value="0"></td>
                    <td><input type="text" id="opponent2_row2" value="0"></td>
                    <td id="cellDeltaO1_row2"><span id="deltaO1_row2">0</span></td>
                    <td id="cellDeltaO2_row2"><span id="deltaO2_row2">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row2">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row3">
                    <td><input type="text" id="playerName_row3" value=""></td>
                    <td><input type="text" id="myPoints_row3" value="0"></td>
                    <td><input type="text" id="opponent1_row3" value="0"></td>
                    <td><input type="text" id="opponent2_row3" value="0"></td>
                    <td id="cellDeltaO1_row3"><span id="deltaO1_row3">0</span></td>
                    <td id="cellDeltaO2_row3"><span id="deltaO2_row3">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row3">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row4">
                    <td><input type="text" id="playerName_row4" value=""></td>
                    <td><input type="text" id="myPoints_row4" value="0"></td>
                    <td><input type="text" id="opponent1_row4" value="0"></td>
                    <td><input type="text" id="opponent2_row4" value="0"></td>
                    <td id="cellDeltaO1_row4"><span id="deltaO1_row4">0</span></td>
                    <td id="cellDeltaO2_row4"><span id="deltaO2_row4">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row4">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row5">
                    <td><input type="text" id="playerName_row5" value=""></td>
                    <td><input type="text" id="myPoints_row5" value="0"></td>
                    <td><input type="text" id="opponent1_row5" value="0"></td>
                    <td><input type="text" id="opponent2_row5" value="0"></td>
                    <td id="cellDeltaO1_row5"><span id="deltaO1_row5">0</span></td>
                    <td id="cellDeltaO2_row5"><span id="deltaO2_row5">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row5">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row6">
                    <td><input type="text" id="playerName_row6" value=""></td>
                    <td><input type="text" id="myPoints_row6" value="0"></td>
                    <td><input type="text" id="opponent1_row6" value="0"></td>
                    <td><input type="text" id="opponent2_row6" value="0"></td>
                    <td id="cellDeltaO1_row6"><span id="deltaO1_row6">0</span></td>
                    <td id="cellDeltaO2_row6"><span id="deltaO2_row6">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row6">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row7">
                    <td><input type="text" id="playerName_row7" value=""></td>
                    <td><input type="text" id="myPoints_row7" value="0"></td>
                    <td><input type="text" id="opponent1_row7" value="0"></td>
                    <td><input type="text" id="opponent2_row7" value="0"></td>
                    <td id="cellDeltaO1_row7"><span id="deltaO1_row7">0</span></td>
                    <td id="cellDeltaO2_row7"><span id="deltaO2_row7">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row7">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row8">
                    <td><input type="text" id="playerName_row8" value=""></td>
                    <td><input type="text" id="myPoints_row8" value="0"></td>
                    <td><input type="text" id="opponent1_row8" value="0"></td>
                    <td><input type="text" id="opponent2_row8" value="0"></td>
                    <td id="cellDeltaO1_row8"><span id="deltaO1_row8">0</span></td>
                    <td id="cellDeltaO2_row8"><span id="deltaO2_row8">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row8">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row9">
                    <td><input type="text" id="playerName_row9" value=""></td>
                    <td><input type="text" id="myPoints_row9" value="0"></td>
                    <td><input type="text" id="opponent1_row9" value="0"></td>
                    <td><input type="text" id="opponent2_row9" value="0"></td>
                    <td id="cellDeltaO1_row9"><span id="deltaO1_row9">0</span></td>
                    <td id="cellDeltaO2_row9"><span id="deltaO2_row9">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row9">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row10">
                    <td><input type="text" id="playerName_row10" value=""></td>
                    <td><input type="text" id="myPoints_row10" value="0"></td>
                    <td><input type="text" id="opponent1_row10" value="0"></td>
                    <td><input type="text" id="opponent2_row10" value="0"></td>
                    <td id="cellDeltaO1_row10"><span id="deltaO1_row10">0</span></td>
                    <td id="cellDeltaO2_row10"><span id="deltaO2_row10">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row10">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row11">
                    <td><input type="text" id="playerName_row11" value=""></td>
                    <td><input type="text" id="myPoints_row11" value="0"></td>
                    <td><input type="text" id="opponent1_row11" value="0"></td>
                    <td><input type="text" id="opponent2_row11" value="0"></td>
                    <td id="cellDeltaO1_row11"><span id="deltaO1_row11">0</span></td>
                    <td id="cellDeltaO2_row11"><span id="deltaO2_row11">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row11">Reset</button></td>
                </tr>
                 <tr class="data-row" data-row-suffix="_row12">
                    <td><input type="text" id="playerName_row12" value=""></td>
                    <td><input type="text" id="myPoints_row12" value="0"></td>
                    <td><input type="text" id="opponent1_row12" value="0"></td>
                    <td><input type="text" id="opponent2_row12" value="0"></td>
                    <td id="cellDeltaO1_row12"><span id="deltaO1_row12">0</span></td>
                    <td id="cellDeltaO2_row12"><span id="deltaO2_row12">0</span></td>
                    <td class="reset-cell"><button class="reset-button" data-row-suffix="_row12">Reset</button></td>
                </tr>
            </tbody>
        </table>
    </div> <script>
        // Funzione per determinare il colore di sfondo in base al valore
        function getColorForValue(value) {
            if (value < -50000) {
                return '#800080'; // Viola intenso
            } else if (value >= -49999 && value <= -20000) {
                return '#C71585'; // Rosso violaceo
            } else if (value >= -19999 && value <= 0) {
                return '#FF0000'; // Rosso vivo
            } else if (value >= 1 && value <= 10000) {
                return '#FF4500'; // Rosso aranciato
            } else if (value >= 10001 && value <= 25000) {
                return '#FFA500'; // Arancione
            } else if (value >= 25001 && value <= 40000) {
                return '#FFD700'; // Giallo aranciato
            } else if (value >= 40001 && value <= 55000) {
                return '#FFFACD'; // Giallo limone
            } else if (value >= 55001 && value <= 70000) {
                return '#AFEEEE'; // Verde acqua chiaro
            } else if (value > 70000) {
                return '#87CEEB'; // Blu cielo
            } else {
                return ''; // Colore di default (trasparente)
            }
        }

        // Funzione per determinare il colore del testo in base al colore di sfondo (opzionale)
        function getTextColorForBackground(bgColor) {
             // Semplice euristica: testo bianco per sfondi scuri, nero per chiari
             const darkColors = ['#800080', '#C71585', '#FF0000', '#C71585']; // Aggiungi qui i colori scuri
             if (darkColors.includes(bgColor)) {
                 return '#FFFFFF'; // Bianco
             }
             return '#000000'; // Nero di default
        }

        // Funzione per salvare i dati di una specifica riga in localStorage
        function saveRowData(rowSuffix) {
            const playerNameInput = document.getElementById('playerName' + rowSuffix);
            const myPointsInput = document.getElementById('myPoints' + rowSuffix);
            const opponent1Input = document.getElementById('opponent1' + rowSuffix);
            const opponent2Input = document.getElementById('opponent2' + rowSuffix);

            if(playerNameInput) localStorage.setItem('playerName' + rowSuffix, playerNameInput.value);
            if(myPointsInput) localStorage.setItem('myPoints' + rowSuffix, myPointsInput.value);
            if(opponent1Input) localStorage.setItem('opponent1' + rowSuffix, opponent1Input.value);
            if(opponent2Input) localStorage.setItem('opponent2' + rowSuffix, opponent2Input.value);
        }

        // Funzione per caricare i dati di una specifica riga da localStorage
        function loadRowData(rowSuffix) {
            const playerName = localStorage.getItem('playerName' + rowSuffix);
            const myPoints = localStorage.getItem('myPoints' + rowSuffix);
            const opponent1 = localStorage.getItem('opponent1' + rowSuffix);
            const opponent2 = localStorage.getItem('opponent2' + rowSuffix);

            // Imposta i valori solo se esistono in localStorage e l'elemento input esiste
            const playerNameInput = document.getElementById('playerName' + rowSuffix);
            const myPointsInput = document.getElementById('myPoints' + rowSuffix);
            const opponent1Input = document.getElementById('opponent1' + rowSuffix);
            const opponent2Input = document.getElementById('opponent2' + rowSuffix);

            if (playerName !== null && playerNameInput) playerNameInput.value = playerName;
            // Per i campi numerici, usiamo 0 se il valore salvato è null o vuoto
            if (myPoints !== null && myPointsInput) myPointsInput.value = myPoints === '' ? '0' : myPoints;
            if (opponent1 !== null && opponent1Input) opponent1Input.value = opponent1 === '' ? '0' : opponent1;
            if (opponent2 !== null && opponent2Input) opponent2Input.value = opponent2 === '' ? '0' : opponent2;
        }

        // Funzione per calcolare, aggiornare i delta e cambiare i colori per una specifica riga
        function updateDeltasAndColors(rowSuffix) {
            // Recupera gli input, usando 0 come fallback se non sono numeri validi
            const myPointsInput = document.getElementById('myPoints' + rowSuffix);
            const opponent1Input = document.getElementById('opponent1' + rowSuffix);
            const opponent2Input = document.getElementById('opponent2' + rowSuffix);

            if (!myPointsInput || !opponent1Input || !opponent2Input) {
                // Elementi non trovati per questa riga, esci
                return;
            }

            const myPoints = parseFloat(myPointsInput.value) || 0;
            const opponent1 = parseFloat(opponent1Input.value) || 0;
            const opponent2 = parseFloat(opponent2Input.value) || 0;

            // Calcola i delta
            const delta1 = myPoints - opponent1;
            const delta2 = myPoints - opponent2;

            // Ottieni gli elementi dove mostrare i delta e le loro celle contenitrici
            const deltaO1Span = document.getElementById('deltaO1' + rowSuffix);
            const deltaO2Span = document.getElementById('deltaO2' + rowSuffix);
            const cellDeltaO1 = document.getElementById('cellDeltaO1' + rowSuffix);
            const cellDeltaO2 = document.getElementById('cellDeltaO2' + rowSuffix);

            // Aggiorna gli span con i risultati
            if (deltaO1Span) deltaO1Span.textContent = delta1; // O delta1.toFixed(n) se vuoi decimali
            if (deltaO2Span) deltaO2Span.textContent = delta2; // O delta2.toFixed(n) se vuoi decimali

            // Determina e imposta i colori di sfondo delle celle
            const color1 = getColorForValue(delta1);
            const color2 = getColorForValue(delta2);

            if (cellDeltaO1) cellDeltaO1.style.backgroundColor = color1;
            if (cellDeltaO2) cellDeltaO2.style.backgroundColor = color2;

            // Determina e imposta i colori del testo per leggibilità
            if (deltaO1Span) deltaO1Span.style.color = getTextColorForBackground(color1);
            if (deltaO2Span) deltaO2Span.style.color = getTextColorForBackground(color2);
        }

        // Funzione per resettare i dati di una specifica riga
        function resetRow(rowSuffix) {
            // Pulisci i campi input
            const playerNameInput = document.getElementById('playerName' + rowSuffix);
            const myPointsInput = document.getElementById('myPoints' + rowSuffix);
            const opponent1Input = document.getElementById('opponent1' + rowSuffix);
            const opponent2Input = document.getElementById('opponent2' + rowSuffix);

            if(playerNameInput) playerNameInput.value = '';
            if(myPointsInput) myPointsInput.value = '0'; // Puoi reimpostare a 0 o vuoto
            if(opponent1Input) opponent1Input.value = '0'; // Puoi reimpostare a 0 o vuoto
            if(opponent2Input) opponent2Input.value = '0';


            // Pulisci i dati da localStorage
            localStorage.removeItem('playerName' + rowSuffix);
            localStorage.removeItem('myPoints' + rowSuffix);
            localStorage.removeItem('opponent1' + rowSuffix);
            localStorage.removeItem('opponent2' + rowSuffix);

            // Aggiorna la visualizzazione dei delta (verranno ricalcolati a 0)
            updateDeltasAndColors(rowSuffix);
        }

        // --- Inizializzazione e Event Listeners ---

        // Ottieni tutti gli elementi riga con la classe 'data-row'
        const dataRows = document.querySelectorAll('.data-row');

        // Carica i dati e inizializza la visualizzazione per ogni riga all'avvio
        dataRows.forEach(row => {
            const rowSuffix = row.dataset.rowSuffix; // Legge il suffisso dall'attributo data-*
            if (rowSuffix) {
                loadRowData(rowSuffix);
                updateDeltasAndColors(rowSuffix);
            }
        });


        // Usa l'Event Delegation sul tbody per gestire gli input e i click sui pulsanti
        const tableBody = document.getElementById('tableBody');

        tableBody.addEventListener('input', function(event) {
            const target = event.target; // L'elemento che ha scatenato l'evento

            // Controlla se l'elemento è un input field all'interno di una riga dati
            if (target.tagName === 'INPUT') {
                const row = target.closest('.data-row'); // Risali al genitore con classe data-row
                if (row) {
                    const rowSuffix = row.dataset.rowSuffix; // Ottieni il suffisso della riga

                    // Salva i dati della riga
                    saveRowData(rowSuffix);

                    // Se l'input è myPoints, opponent1 o opponent2, aggiorna anche i delta e i colori
                    if (target.id.startsWith('myPoints') || target.id.startsWith('opponent1') || target.id.startsWith('opponent2')) {
                         updateDeltasAndColors(rowSuffix);
                    }
                }
            }
        });

        tableBody.addEventListener('click', function(event) {
            const target = event.target; // L'elemento che ha scatenato l'evento

            // Controlla se l'elemento è un pulsante di reset
            if (target.classList.contains('reset-button')) {
                 const row = target.closest('.data-row'); // Risali al genitore con classe data-row
                 if (row) {
                     const rowSuffix = row.dataset.rowSuffix; // Ottieni il suffisso della riga
                     resetRow(rowSuffix); // Resetta solo quella riga
                 }
            }
        });

    </script>

</body>
</html>